<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Declinación Solar</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.0/full/pyodide.js"></script>
</head>
<body>
    <h2>Calculadora de Declinación Solar</h2>
    <label for="ciudad">Nombre de la ciudad:</label>
    <input type="text" id="ciudad" placeholder="Ej. Madrid">
    <br><br>
    <label for="latitud">Latitud:</label>
    <input type="number" id="latitud" step="0.01" placeholder="Ej. 40.42">
    <br><br>
    <button onclick="calcular()">Calcular</button>
    <br><br>
    <div id="output"></div>
    
    <script>
        async function main() {
            window.pyodide = await loadPyodide();
            console.log("Pyodide cargado correctamente");
        }
        
        main(); // Cargar Pyodide al inicio

        async function calcular() {
            try {
                let ciudad = document.getElementById("ciudad").value;
                let latitud = parseFloat(document.getElementById("latitud").value);
                let outputDiv = document.getElementById("output");
                outputDiv.innerHTML = "Calculando...";
                console.log("Iniciando cálculo para", ciudad, "con latitud", latitud);

                let code = `
import math

ciudad = "${ciudad}"
latitud = ${latitud}
diasdelaño = [15, 46, 74, 105, 135, 166, 196, 227, 258, 288, 319, 349]

tabla = ""
for n in diasdelaño:
    delta = 23.45 * math.sin(math.radians(((n - 81) * 360) / 365))
    tandelta = math.tan(math.radians(delta))
    tanphi = math.tan(math.radians(latitud))
    hora = (2 / 15) * math.degrees(math.acos(-tanphi * tandelta))
    horanoche_valor = 24 - hora

    horaentera = int(hora)
    minutoshora = round((hora - horaentera) * 60)
    horanocheentera = int(horanoche_valor)
    minutoshoranoche = round((horanoche_valor - horanocheentera) * 60)
    tabla += f"<p>Día {n}: Día: {horaentera:02}:{minutoshora:02}, Noche: {horanocheentera:02}:{minutoshoranoche:02}</p>"

output = tabla
                `;

                let result = await pyodide.runPythonAsync(code);
                let output = pyodide.globals.get("output").toJs();
                outputDiv.innerHTML = output;
                console.log("Cálculo completado");
            } catch (error) {
                console.error("Error en la ejecución:", error);
                document.getElementById("output").innerHTML = "Error en el cálculo. Ver la consola para más detalles.";
            }
        }
    </script>
</body>
</html>
